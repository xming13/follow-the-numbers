var XMing=XMing||{};XMing.GameStateManager=new function(){var c;var d;var g;var e=0;var k=[{image:"images/egg.png",text:"egg",title:"I come first before chicken!",subtitle:"Some disagree."},{image:"images/chicken.png",text:"chicken",title:"I come first before egg!",subtitle:"Most agree."},{image:"images/mushroom.png",text:"mushroom",title:"Beware!",subtitle:"Mario's size doubles when consumed."},{image:"images/apple.png",text:"apple",title:"I fell on Newton's head",subtitle:"Snow White couldn't resist me!\nI bent."},{image:"images/banana.png",text:"banana",title:"Many fell as they slip on me",subtitle:"Minions love me!\nI split."},{image:"images/carrot.png",text:"carrot",title:'"I know nobody will see my status"',subtitle:'"but sometimes when I am bored, I go into the garden, I cover myself in earth and I pretend I am a ______."'},{image:"images/orange.png",text:"orange",title:"I am a colour. I am a fruit. The colour of the fruit is me.",subtitle:"This relationship is complicated."},{image:"images/batman.png",text:"batman",title:'In javascript: Array(16).join("lol" - 2)',subtitle:"NaNNaNNaNNaNNaNNaNNaNNaN\nNaNNaNNaNNaNNaNNaNNaN"},{image:"images/hellokitty.png",text:"hellokitty",title:"A cat without mouth",subtitle:"Never was a cat"},{image:"images/snoopy.png",text:"snoopy",title:"A dog (beagle)",subtitle:"Confirmed by Peanuts"},{image:"images/pig.png",text:"pig",title:"What is life?",subtitle:"Eat. Play. Sleep."},{image:"images/fish.png",text:"fish",title:"What is life?",subtitle:"Hunt the smaller ones.\nAvoid the bigger ones."}];var h=_.range(_.size(k));var f;var j=[];var a;var b=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];var i={INITIAL:"initial",START:"start",PAUSE:"pause",END:"end"};this.init=function(){window.addEventListener("resize",this.onResize.bind(this),false);this.initGame()};this.loadGrid=function(){var l=_.sample(h);h=_.without(h,l);j=[];f=k[l];var m=f.text.split("");m=_.shuffle(m.concat(_.sample(_.difference(b,m),16-m.length)));$(".game-grid").html("");_.each(m,function(n){$(".game-grid").append("<li><div class='content animated fadeIn'>"+n+"</li>")})};this.loadData=function(){var l=this;this.loadGrid();g=10.5;$("#timer-value").html(Math.floor(g)).removeClass("animated fadeIn");$("#image-to-guess").attr("src",f.image);swal({title:f.title,text:f.subtitle+"\n\n("+f.text.length+"-letter word)",imageUrl:f.image},function(){(function m(){g-=0.5;$("#timer-value").html(Math.ceil(g));$("#timer-value").addClass("animated fadeIn");$("#score-value").html(e);if(g<=0){clearTimeout(d);$("#result-content").html("Time's up!").addClass("animated bounceIn").css("color","rgba(17, 189, 255, 255)");$("#timer-value").removeClass("animated fadeIn");l.loadNextRound()}else{d=setTimeout(m,500)}})()});this.loadSelectedLetters();$("ul.game-grid li").click(function(){if($(this).hasClass("selected")){$(this).removeClass("selected");var n=$(this).attr("data-number");j.splice(n-1,1);_.each(_.filter($("ul.game-grid li"),function(o){return $(o).attr("data-number")>n}),function(o){$(o).attr("data-number",parseInt($(o).attr("data-number"))-1)});l.loadSelectedLetters()}else{if(j.length<f.text.split("").length){$(this).addClass("selected");var m=$(this.firstChild).html();j.push(m);$(this).attr("data-number",j.length);l.loadSelectedLetters();l.checkResult()}}})};this.loadSelectedLetters=function(){$(".game-letters span").remove();_.each(j,function(n){$(".game-letters").append("<span>"+n+"</span>")});var l=f.text.split("").length;var m=l-j.length;_.times(m,function(){$(".game-letters").append("<span>&nbsp;&nbsp;&nbsp;</span>")})};this.checkResult=function(){if(_.isEqual(j,f.text.split(""))){$("#result-content").html("Correct!").addClass("animated bounceIn").css("color","rgba(0, 255, 0, 255)");e+=g*10;$(".score-change").html("+"+g*10).css("color","rgba(0, 255, 0, 255)");$("#timer-value").removeClass("animated fadeIn");$("#score-value").html(e);$(".score-change").animate({top:"-25px"},{duration:1000,complete:function(){$(".score-change").html("").css("top","-10px")}});clearTimeout(d);this.loadNextRound()}else{if(j.length==f.text.split("").length){$(".game-letters").addClass("animated shake answer-wrong");$(".game-letters").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated shake answer-wrong")})}}};this.loadNextRound=function(){var l=this;var m=$("ul.game-grid");$("#result").width(m.width()).height(m.height()).show();_.delay(function(){$("#result").hide();if(_.size(h)>0){l.loadData()}else{l.endGame()}},1000)};this.onResize=function(p){var m=$(".game-grid").children("li");var l=_.max(m,function(q){return $(q).width()});var o=$(l).width();_.each(m,function(q){$(q).height(o)});var n="<style>.game-grid li { height: "+o+"px; } .game-grid li .content { font-size: "+(o*0.5)+"px; } #result-content { font-size: "+(o*0.8)+"px; } .game-letters span { font-size: "+(o*0.2)+"px; margin-left: "+(o*0.1)+"px; } </style>";if(a){a.html(n)}else{a=$("<div />",{html:n}).appendTo("body")}};this.preloadImage=function(){_.each(k,function(n){var m=new Image();m.src=n.image});var l=new Image();l.src="images/love.png"};this.initGame=function(){c=i.INITIAL;this.preloadImage();var l=this;$(".icon-repeat").click(function(){l.startGame()})};this.startGame=function(){c=i.START;e=0;h=_.range(_.size(k));$("#timer").show();$("#replay").hide();this.onResize();this.loadData()};this.endGame=function(){c=i.END;var l=this;$("#image-to-guess").attr("src","images/word-grid.png");j=[];f={image:"images/word-grid.png",text:"GAMELOVER"};this.loadSelectedLetters();$(".game-grid").html("");var m=["G","A","M","E","O","V","E","R","L"];_.times(7,function(){m.push("#")});_.each(_.shuffle(m),function(n){$(".game-grid").append("<li><div class='content animated fadeIn'>"+n+"</li>")});$("#timer").hide();$("#replay").show();$("#score-value").html(e);swal({title:"Congratulations!",text:"Your score is "+e+"! :D",imageUrl:"images/word-grid.png"});$("ul.game-grid li").click(function(){if($(this).hasClass("selected")){$(this).removeClass("selected");var o=$(this).attr("data-number");j.splice(o-1,1);_.each(_.filter($("ul.game-grid li"),function(p){return $(p).attr("data-number")>o}),function(p){$(p).attr("data-number",parseInt($(p).attr("data-number"))-1)});l.loadSelectedLetters()}else{if(j.length<f.text.split("").length){$(this).addClass("selected");var n=$(this.firstChild).html();j.push(n);$(this).attr("data-number",j.length);l.loadSelectedLetters();if(_.isEqual(j,f.text.split(""))){swal({title:"Thanks for playing!!!",imageUrl:"images/love.png"})}else{if(j.length==f.text.split("").length){$(".game-letters").addClass("animated shake answer-wrong");$(".game-letters").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated shake answer-wrong")})}}}}})};this.isGameStateInitial=function(){return c==i.INITIAL};this.isGameStateStart=function(){return c==i.START};this.isGameStateEnd=function(){return c==i.END}};