var XMing=XMing||{};XMing.GameStateManager=new function(){var c;var d;var g;var e=0;var i=_.each(_.range(1,17),function(m){return m+""});var j=["I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII","XIII","XIV","XV","XVI"];var f=i;var a="arabic";var h=0;var l=[];var b;var k={INITIAL:"initial",START:"start",PAUSE:"pause",END:"end"};this.init=function(){window.addEventListener("resize",this.onResize.bind(this),false);this.initGame()};this.loadGrid=function(){l=[];var m=_.first(f,h);m=_.shuffle(m.concat(_.times(16-h,function(){return""})));$(".game-grid").html("");_.each(m,function(n){$(".game-grid").append("<li><div class='content'>"+n+"</li>")});$(".game-grid").addClass("animated fadeIn");$(".game-grid.animated.fadeIn").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(".game-grid.animated.fadeIn").removeClass("animated fadeIn")})};this.loadData=function(){var m=this;h++;this.loadGrid();g=h+3.5;$("#timer-value").html(Math.floor(g));(function n(){g-=0.5;$("#timer-value").html(Math.ceil(g));$("#timer-value").addClass("animated fadeIn");$("#score-value").html(e);if(g<=0){clearTimeout(d);$("#result-content").html("Time's up!").addClass("animated bounceIn").css("color","rgba(17, 189, 255, 255)");$("#timer-value").removeClass("animated fadeIn");m.loadNextRound()}else{d=setTimeout(n,500)}})();$("ul.game-grid li").click(function(){if(!$(this).hasClass("selected")){var p=$(this.firstChild).html();if(p==f[l.length]){$(this).addClass("selected");l.push(p);m.checkResult()}else{if(p!=""){var o=$(this.firstChild);o.addClass("animated shake");o.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){o.removeClass("animated shake")})}}}})};this.checkResult=function(){if(l.length==h){$("#result-content").html("Correct!").addClass("animated bounceIn").css("color","rgba(0, 255, 0, 255)");e+=g*10;$(".score-change").html("+"+g*10).css("color","rgba(0, 255, 0, 255)");$("#timer-value").removeClass("animated fadeIn");$("#score-value").html(e);$(".score-change").animate({top:"-25px"},{duration:1000,complete:function(){$(".score-change").html("").css("top","-10px")}});clearTimeout(d);this.loadNextRound()}};this.loadNextRound=function(){var m=this;var n=$("ul.game-grid");$("#result").width(n.width()).height(n.height()).show();_.delay(function(){$("#result").hide();if(h<f.length){m.loadData()}else{m.endGame()}},1000)};this.onResize=function(q){var n=$(".game-grid").children("li");var m=_.max(n,function(r){return $(r).width()});var p=$(m).width();_.each(n,function(r){$(r).height(p)});var o="<style>.game-grid li { height: "+p+"px; } .game-grid li .content { font-size: "+(p*0.5)+"px; } #result-content { font-size: "+(p*0.8)+"px; } .game-letters span { font-size: "+(p*0.2)+"px; margin-left: "+(p*0.1)+"px; } </style>";if(b){b.html(o)}else{b=$("<div />",{html:o}).appendTo("body")}};this.preloadImage=function(){var m=new Image();m.src="images/love.png"};this.initGame=function(){c=k.INITIAL;this.preloadImage();var m=this;$(".icon-repeat").click(function(){m.startGame()})};this.startGame=function(){c=k.START;var m=this;e=0;h=0;$("#timer").show();$("#replay").hide();this.onResize();swal({title:"Choose a Numeric Type",showCancelButton:true,confirmButtonText:"1 2 3",confirmButtonColor:"#ff0000",cancelButtonText:"I II III"},function(n){if(n){a="arabic";f=i}else{a="roman";f=j}m.loadData()})};this.endGame=function(){c=k.END;var n=this;$(".game-grid").html("");var m=_.first(f,8);var q=_.shuffle(m);var p=["G","A","M","E","O","V","E","R"];_.each(_.first(q,4),function(r){$(".game-grid").append("<li><div class='content animated fadeIn'>"+r+"</li>")});_.each(p,function(r){$(".game-grid").append("<li><div class='content animated fadeIn'>"+r+"</li>")});_.each(_.last(q,4),function(r){$(".game-grid").append("<li><div class='content animated fadeIn'>"+r+"</li>")});$("#timer").hide();$("#replay").show();$("#score-value").html(e);var o=(a=="arabic"?"images/1_2_3.png":"images/I_II_III.png");swal({title:"Congratulations!",text:"Your score is "+e+"! :D",imageUrl:o});l=[];$("ul.game-grid li").click(function(){if(!$(this).hasClass("selected")){var r=$(this.firstChild).html();if(r==m[l.length]){$(this).addClass("selected");l.push(r);if(l.length==m.length){swal({title:"Thanks for playing!!!",imageUrl:"images/love.png"})}}else{if(r!=""){$(this.firstChild).addClass("animated shake");$(this.firstChild).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this.firstChild).removeClass("animated shake")})}}}})};this.isGameStateInitial=function(){return c==k.INITIAL};this.isGameStateStart=function(){return c==k.START};this.isGameStateEnd=function(){return c==k.END}};