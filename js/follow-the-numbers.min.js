var XMing=XMing||{};XMing.GameStateManager=new function(){var e=0;var t;var n;var r;var i=0;var s=_.each(_.range(1,17),function(e){return e+""});var o=["I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII","XIII","XIV","XV","XVI"];var u=s;var a="arabic";var f=0;var l=[];var c;var h={INITIAL:"initial",START:"start",PAUSE:"pause",END:"end"};this.init=function(){window.addEventListener("resize",this.onResize.bind(this),false);this.initGame()};this.loadGrid=function(){l=[];var e=_.first(u,f);e=_.shuffle(e.concat(_.times(16-f,function(){return""})));$(".game-grid").html("");_.each(e,function(e){$(".game-grid").append("<li><div class='content'>"+e+"</li>")});$(".game-grid").addClass("animated fadeIn");$(".game-grid.animated.fadeIn").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(".game-grid.animated.fadeIn").removeClass("animated fadeIn")})};this.loadData=function(){var e=this;f++;this.loadGrid();r=f+3.5;$("#timer-value").html(Math.floor(r));(function t(){r-=.5;$("#timer-value").html(Math.ceil(r));$("#timer-value").addClass("animated fadeIn");$("#score-value").html(i);if(r<=0){clearTimeout(n);$("#result-content").html("Time's up!").addClass("animated bounceIn").css("color","rgba(17, 189, 255, 255)");$("#timer-value").removeClass("animated fadeIn");e.loadNextRound()}else{n=setTimeout(t,500)}})();$("ul.game-grid li").click(function(){if(!$(this).hasClass("selected")){var t=$(this.firstChild).html();if(t==u[l.length]){$(this).addClass("selected");l.push(t);e.checkResult()}else{if(t!=""){var n=$(this.firstChild);n.addClass("animated shake");n.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){n.removeClass("animated shake")})}}}})};this.checkResult=function(){if(l.length==f){$("#result-content").html("Correct!").addClass("animated bounceIn").css("color","rgba(0, 255, 0, 255)");i+=r*10;$(".score-change").html("+"+r*10).css("color","rgba(0, 255, 0, 255)");$("#timer-value").removeClass("animated fadeIn");$("#score-value").html(i);$(".score-change").animate({top:"-25px"},{duration:1e3,complete:function(){$(".score-change").html("").css("top","-10px")}});clearTimeout(n);this.loadNextRound()}};this.loadNextRound=function(){var e=this;var t=$("ul.game-grid");$("#result").width(t.width()).height(t.height()).show();_.delay(function(){$("#result").hide();if(f<u.length){e.loadData()}else{e.endGame()}},1e3)};this.onResize=function(t){if($(window).width()!=e){e=$(window).width();if(c){c.html("")}var n=$(".game-grid").children("li");var r=_.max(n,function(e){return $(e).width()});var i=$(r).width();var s="<style>";s+=" ul.game-grid { width: "+(i*4)+"px; } ";s+=" .game-grid li { height: "+i+"px; width: "+i+"px; } ";s+=" .game-grid li .content { font-size: "+i*.5+"px; } ";s+=" #result-content { font-size: "+i*.8+"px; } ";s+=" .game-letters span { font-size: "+i*.2+"px; margin-left: "+i*.1+"px; } ";s+="</style>";if(c){c.html(s)}else{c=$("<div />",{html:s}).appendTo("body")}}};this.preloadImage=function(){var e=new Image;e.src="images/love.png"};this.initGame=function(){t=h.INITIAL;this.preloadImage();var e=this;$(".icon-repeat").click(function(){e.startGame()})};this.startGame=function(){t=h.START;var n=this;i=0;f=0;$("#timer").show();$("#replay").hide();e=0;this.onResize();swal({title:"Choose a Numeric Type",showCancelButton:true,confirmButtonText:"1 2 3",confirmButtonColor:"#ff0000",cancelButtonText:"I II III"},function(e){if(e){a="arabic";u=s}else{a="roman";u=o}n.loadData()})};this.endGame=function(){t=h.END;var e=this;$(".game-grid").html("");var n=_.first(u,8);var r=_.shuffle(n);var s=["G","A","M","E","O","V","E","R"];_.each(_.first(r,4),function(e){$(".game-grid").append("<li><div class='content animated fadeIn'>"+e+"</li>")});_.each(s,function(e){$(".game-grid").append("<li><div class='content animated fadeIn'>"+e+"</li>")});_.each(_.last(r,4),function(e){$(".game-grid").append("<li><div class='content animated fadeIn'>"+e+"</li>")});$("#timer").hide();$("#replay").show();$("#score-value").html(i);var o=a=="arabic"?"images/1_2_3.png":"images/I_II_III.png";swal({title:"Congratulations!",text:"Your score is "+i+"! :D",imageUrl:o});l=[];$("ul.game-grid li").click(function(){if(!$(this).hasClass("selected")){var e=$(this.firstChild).html();if(e==n[l.length]){$(this).addClass("selected");l.push(e);if(l.length==n.length){swal({title:"Thanks for playing!!!",imageUrl:"images/love.png"})}}else{if(e!=""){$(this.firstChild).addClass("animated shake");$(this.firstChild).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this.firstChild).removeClass("animated shake")})}}}})};this.isGameStateInitial=function(){return t==h.INITIAL};this.isGameStateStart=function(){return t==h.START};this.isGameStateEnd=function(){return t==h.END}}